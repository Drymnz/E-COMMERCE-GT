<div class="container-fluid py-4">
  <!-- Encabezado -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <h2 class="mb-0">
          <i class="bi bi-shield-check me-2"></i>
          Panel de Moderación
        </h2>
        <span class="badge bg-primary fs-6">
          <i class="bi bi-clock-history me-1"></i>
          {{ totalArticulos }} pendientes
        </span>
      </div>
      <hr class="my-3">
    </div>
  </div>

  <!-- Loader -->
  @if (cargando) {
  <div class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-3 text-muted">Cargando artículos...</p>
  </div>
  }

  <!-- Sin artículos -->
  @if (!cargando && articulos.length === 0) {
  <div class="text-center py-5">
    <i class="bi bi-inbox display-1 text-muted"></i>
    <h4 class="mt-3 text-muted">No hay artículos pendientes</h4>
    <p class="text-muted">Todos los artículos han sido moderados</p>
  </div>
  }

  <!-- Lista de artículos -->
  @if (!cargando && articulos.length > 0) {
  <div class="row g-3 mb-4">
    @for (articulo of articulos; track articulo.id_articulo) {
    <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-2">
      <!-- Tarjeta del artículo -->
      <div class="card h-100">
        <app-article
          [articulo]="articulo"
          [estadoNombre]="obtenerEstadoNombre(articulo.id_estado_articulo)"
          [disponible]="articulo.disponible"
          [mostrarAcciones]="false"
        ></app-article>

        <div class="card-footer bg-white">
          <!-- Badge de estado de moderación -->
          <div class="mb-2">
            <span class="badge w-100 py-2" 
                  [ngClass]="{
                    'bg-warning text-dark': articulo.id_accion === 1,
                    'bg-success': articulo.id_accion === 2,
                    'bg-danger': articulo.id_accion === 3
                  }">
              <i class="bi bi-shield-check me-1"></i>
              {{ obtenerEstadoModeracion(articulo.id_accion) }}
            </span>
          </div>

          <!-- Botones de moderación -->
          <div class="d-grid gap-2">
            <button
              class="btn btn-success btn-sm"
              (click)="abrirModalAprobar(articulo)"
            >
              <i class="bi bi-check-circle me-1"></i>
              Aprobar
            </button>
            <button
              class="btn btn-danger btn-sm"
              (click)="abrirModalRechazar(articulo)"
            >
              <i class="bi bi-x-circle me-1"></i>
              Rechazar
            </button>
          </div>
        </div>
      </div>
    </div>
    }
  </div>

  <!-- Paginación -->
  <nav aria-label="Paginación de artículos">
    <ul class="pagination justify-content-center mb-3">
      <!-- Botón anterior -->
      <li class="page-item" [class.disabled]="paginaActual === 1">
        <button
          class="page-link"
          (click)="paginaAnterior()"
          [disabled]="paginaActual === 1"
          aria-label="Anterior"
        >
          <i class="bi bi-chevron-left"></i>
        </button>
      </li>

      <!-- Primera página -->
      @if (paginaActual > 3) {
      <li class="page-item">
        <button class="page-link" (click)="cambiarPagina(1)">1</button>
      </li>
      <li class="page-item disabled">
        <span class="page-link">...</span>
      </li>
      }

      <!-- Páginas -->
      @for (pagina of rangoPaginas; track pagina) {
      <li class="page-item" [class.active]="pagina === paginaActual">
        <button 
          class="page-link" 
          (click)="cambiarPagina(pagina)"
          [attr.aria-current]="pagina === paginaActual ? 'page' : null"
        >
          {{ pagina }}
        </button>
      </li>
      }

      <!-- Última página -->
      @if (paginaActual < totalPaginas - 2) {
      <li class="page-item disabled">
        <span class="page-link">...</span>
      </li>
      <li class="page-item">
        <button class="page-link" (click)="cambiarPagina(totalPaginas)">
          {{ totalPaginas }}
        </button>
      </li>
      }

      <!-- Botón siguiente -->
      <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
        <button
          class="page-link"
          (click)="paginaSiguiente()"
          [disabled]="paginaActual === totalPaginas"
          aria-label="Siguiente"
        >
          <i class="bi bi-chevron-right"></i>
        </button>
      </li>
    </ul>

    <!-- Info de paginación -->
    <p class="text-center text-muted">
      <small>
        Página {{ paginaActual }} de {{ totalPaginas }} 
        ({{ articulos.length }} de {{ totalArticulos }} artículos)
      </small>
    </p>
  </nav>
  }
</div>

<!-- Modal de confirmación para aprobar -->
<app-notify-confirm
  [mostrar]="mostrarModalAprobar"
  [titulo]="'Aprobar artículo'"
  [mensaje]="'¿Está seguro de que desea aprobar este artículo?'"
  [mensajeSecundario]="articuloSeleccionado?.nombre || ''"
  [textoConfirmar]="'Aprobar'"
  [textoCancelar]="'Cancelar'"
  [tipoAlerta]="'info'"
  [iconoAlerta]="'bi-check-circle-fill'"
  [mostrarAdvertencia]="false"
  (confirmar)="confirmarAprobar()"
  (cancelar)="cerrarModalAprobar()"
></app-notify-confirm>

<!-- Modal de confirmación para rechazar -->
<app-notify-confirm
  [mostrar]="mostrarModalRechazar"
  [titulo]="'Rechazar artículo'"
  [mensaje]="'¿Está seguro de que desea rechazar este artículo?'"
  [mensajeSecundario]="articuloSeleccionado?.nombre || ''"
  [textoConfirmar]="'Rechazar'"
  [textoCancelar]="'Cancelar'"
  [tipoAlerta]="'danger'"
  [iconoAlerta]="'bi-x-circle-fill'"
  [mostrarAdvertencia]="true"
  [textoAdvertencia]="'El artículo será marcado como rechazado.'"
  (confirmar)="confirmarRechazar()"
  (cancelar)="cerrarModalRechazar()"
></app-notify-confirm>