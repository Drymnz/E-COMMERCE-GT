<div class="container-fluid py-4">
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="display-5 fw-bold text-center">
        <i class="bi bi-graph-up-arrow me-2"></i>Reportes del Sistema
      </h1>
    </div>
  </div>

  <!-- Pesta침as de navegaci칩n -->
  <ul class="nav nav-tabs mb-4" role="tablist">
    <li class="nav-item" role="presentation">
      <button 
        class="nav-link"
        [class.active]="pestanaActiva() === 'productos'"
        (click)="cambiarPestana('productos')"
        type="button">
        <i class="bi bi-trophy me-2"></i>Top Productos Vendidos
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button 
        class="nav-link"
        [class.active]="pestanaActiva() === 'compradores'"
        (click)="cambiarPestana('compradores')"
        type="button">
        <i class="bi bi-cash-coin me-2"></i>Mejores Compradores
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button 
        class="nav-link"
        [class.active]="pestanaActiva() === 'vendedores'"
        (click)="cambiarPestana('vendedores')"
        type="button">
        <i class="bi bi-graph-up me-2"></i>Mejores Vendedores
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button 
        class="nav-link"
        [class.active]="pestanaActiva() === 'pedidos'"
        (click)="cambiarPestana('pedidos')"
        type="button">
        <i class="bi bi-box-seam me-2"></i>M치s Pedidos
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button 
        class="nav-link"
        [class.active]="pestanaActiva() === 'productos-venta'"
        (click)="cambiarPestana('productos-venta')"
        type="button">
        <i class="bi bi-shop me-2"></i>M치s Productos en Venta
      </button>
    </li>
  </ul>

  <!-- Contenido de las pesta침as -->
  <div class="tab-content">
    
    <!-- Tab: Top 10 Productos M치s Vendidos -->
    @if (pestanaActiva() === 'productos') {
      <div class="tab-pane fade show active">
        <div class="card mb-4">
          <div class="card-body">
            <h2 class="card-title h4 mb-3">
              <i class="bi bi-trophy-fill text-warning me-2"></i>Top 10 Productos M치s Vendidos
            </h2>
            
            <div class="row g-3 mb-3">
              <div class="col-md-4">
                <label class="form-label fw-semibold">Fecha Inicio</label>
                <input 
                  type="datetime-local" 
                  [(ngModel)]="filtroProductos.fechaInicio"
                  class="form-control">
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">Fecha Fin</label>
                <input 
                  type="datetime-local" 
                  [(ngModel)]="filtroProductos.fechaFin"
                  class="form-control">
              </div>
            </div>

            <div class="d-flex gap-2 flex-wrap mb-3">
              <button (click)="aplicarRangoRapido('semana', filtroProductos)" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-calendar-week me-1"></i>칔ltima semana
              </button>
              <button (click)="aplicarRangoRapido('mes', filtroProductos)" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-calendar-month me-1"></i>칔ltimo mes
              </button>
              <button (click)="aplicarRangoRapido('anio', filtroProductos)" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-calendar-range me-1"></i>칔ltimo a침o
              </button>
            </div>

            <button (click)="cargarReporteProductos()" class="btn btn-primary" [disabled]="cargandoProductos()">
              @if (cargandoProductos()) {
                <span class="spinner-border spinner-border-sm me-2"></span>
                Cargando...
              } @else {
                <i class="bi bi-search me-2"></i>
                Consultar
              }
            </button>
          </div>
        </div>

        @if (cargandoProductos()) {
          <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
          </div>
        }

        @if (!cargandoProductos()) {
          <div class="card">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th scope="col" class="text-center">#</th>
                      <th scope="col">Imagen</th>
                      <th scope="col">Producto</th>
                      <th scope="col">Descripci칩n</th>
                      <th scope="col">Precio</th>
                      <th scope="col" class="text-center">Stock</th>
                      <th scope="col" class="text-center">Estado</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (producto of productosVendidos(); track producto; let i = $index) {
                      <tr>
                        <td class="text-center fw-bold">{{ i + 1 }}</td>
                        <td>
                          <img [src]="producto.imagen" [alt]="producto.nombre" 
                               class="img-thumbnail" style="width: 50px; height: 50px; object-fit: cover;">
                        </td>
                        <td class="fw-semibold">{{ producto.nombre }}</td>
                        <td>{{ producto.descripcion }}</td>
                        <td class="text-success fw-bold">{{ producto.precioFormateado }}</td>
                        <td class="text-center">{{ producto.stock }}</td>
                        <td class="text-center">
                          <span class="badge" 
                                [class.bg-success]="producto.disponible" 
                                [class.bg-danger]="!producto.disponible">
                            {{ producto.estadoStock }}
                          </span>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
                @if (productosVendidos().length === 0) {
                  <div class="alert alert-info text-center">
                    <i class="bi bi-info-circle me-2"></i>No hay datos disponibles para el per칤odo seleccionado
                  </div>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }

    <!-- Tab: Top 5 Mejores Compradores -->
    @if (pestanaActiva() === 'compradores') {
      <div class="tab-pane fade show active">
        <div class="card mb-4">
          <div class="card-body">
            <h2 class="card-title h4 mb-3">
              <i class="bi bi-cash-coin text-success me-2"></i>Top 5 Clientes que M치s Ganancias Generan
            </h2>
            
            <div class="row g-3 mb-3">
              <div class="col-md-4">
                <label class="form-label fw-semibold">Fecha Inicio</label>
                <input 
                  type="datetime-local" 
                  [(ngModel)]="filtroCompradores.fechaInicio"
                  class="form-control">
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">Fecha Fin</label>
                <input 
                  type="datetime-local" 
                  [(ngModel)]="filtroCompradores.fechaFin"
                  class="form-control">
              </div>
            </div>

            <div class="d-flex gap-2 flex-wrap mb-3">
              <button (click)="aplicarRangoRapido('semana', filtroCompradores)" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-calendar-week me-1"></i>칔ltima semana
              </button>
              <button (click)="aplicarRangoRapido('mes', filtroCompradores)" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-calendar-month me-1"></i>칔ltimo mes
              </button>
              <button (click)="aplicarRangoRapido('anio', filtroCompradores)" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-calendar-range me-1"></i>칔ltimo a침o
              </button>
            </div>

            <button (click)="cargarReporteCompradores()" class="btn btn-primary" [disabled]="cargandoCompradores()">
              @if (cargandoCompradores()) {
                <span class="spinner-border spinner-border-sm me-2"></span>
                Cargando...
              } @else {
                <i class="bi bi-search me-2"></i>
                Consultar
              }
            </button>
          </div>
        </div>

        @if (cargandoCompradores()) {
          <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
          </div>
        }

        @if (!cargandoCompradores()) {
          <div class="card">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th scope="col" class="text-center">#</th>
                      <th scope="col">ID Usuario</th>
                      <th scope="col">Nombre</th>
                      <th scope="col">Apellido</th>
                      <th scope="col">Email</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (cliente of clientesCompradores(); track cliente; let i = $index) {
                      <tr>
                        <td class="text-center">
                          @if (i === 0) {
                            <span class="fs-4">游볞</span>
                          } @else if (i === 1) {
                            <span class="fs-4">游볟</span>
                          } @else if (i === 2) {
                            <span class="fs-4">游볠</span>
                          } @else {
                            <span class="fw-bold">{{ i + 1 }}</span>
                          }
                        </td>
                        <td>{{ cliente.id_usuario }}</td>
                        <td>{{ cliente.nombre }}</td>
                        <td>{{ cliente.apellido }}</td>
                        <td>{{ cliente.email }}</td>
                      </tr>
                    }
                  </tbody>
                </table>
                @if (clientesCompradores().length === 0) {
                  <div class="alert alert-info text-center">
                    <i class="bi bi-info-circle me-2"></i>No hay datos disponibles para el per칤odo seleccionado
                  </div>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }

    <!-- Tab: Top 5 Mejores Vendedores -->
    @if (pestanaActiva() === 'vendedores') {
      <div class="tab-pane fade show active">
        <div class="card mb-4">
          <div class="card-body">
            <h2 class="card-title h4 mb-3">
              <i class="bi bi-graph-up text-primary me-2"></i>Top 5 Clientes que M치s Productos Han Vendido
            </h2>
            
            <div class="row g-3 mb-3">
              <div class="col-md-4">
                <label class="form-label fw-semibold">Fecha Inicio</label>
                <input 
                  type="datetime-local" 
                  [(ngModel)]="filtroVendedores.fechaInicio"
                  class="form-control">
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">Fecha Fin</label>
                <input 
                  type="datetime-local" 
                  [(ngModel)]="filtroVendedores.fechaFin"
                  class="form-control">
              </div>
            </div>

            <div class="d-flex gap-2 flex-wrap mb-3">
              <button (click)="aplicarRangoRapido('semana', filtroVendedores)" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-calendar-week me-1"></i>칔ltima semana
              </button>
              <button (click)="aplicarRangoRapido('mes', filtroVendedores)" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-calendar-month me-1"></i>칔ltimo mes
              </button>
              <button (click)="aplicarRangoRapido('anio', filtroVendedores)" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-calendar-range me-1"></i>칔ltimo a침o
              </button>
            </div>

            <button (click)="cargarReporteVendedores()" class="btn btn-primary" [disabled]="cargandoVendedores()">
              @if (cargandoVendedores()) {
                <span class="spinner-border spinner-border-sm me-2"></span>
                Cargando...
              } @else {
                <i class="bi bi-search me-2"></i>
                Consultar
              }
            </button>
          </div>
        </div>

        @if (cargandoVendedores()) {
          <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
          </div>
        }

        @if (!cargandoVendedores()) {
          <div class="card">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th scope="col" class="text-center">#</th>
                      <th scope="col">ID Usuario</th>
                      <th scope="col">Nombre</th>
                      <th scope="col">Apellido</th>
                      <th scope="col">Email</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (cliente of clientesVendedores(); track cliente; let i = $index) {
                      <tr>
                        <td class="text-center">
                          @if (i === 0) {
                            <span class="fs-4">游볞</span>
                          } @else if (i === 1) {
                            <span class="fs-4">游볟</span>
                          } @else if (i === 2) {
                            <span class="fs-4">游볠</span>
                          } @else {
                            <span class="fw-bold">{{ i + 1 }}</span>
                          }
                        </td>
                        <td>{{ cliente.id_usuario }}</td>
                        <td>{{ cliente.nombre }}</td>
                        <td>{{ cliente.apellido }}</td>
                        <td>{{ cliente.email }}</td>
                      </tr>
                    }
                  </tbody>
                </table>
                @if (clientesVendedores().length === 0) {
                  <div class="alert alert-info text-center">
                    <i class="bi bi-info-circle me-2"></i>No hay datos disponibles para el per칤odo seleccionado
                  </div>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }

    <!-- Tab: Top 10 Clientes con M치s Pedidos -->
    @if (pestanaActiva() === 'pedidos') {
      <div class="tab-pane fade show active">
        <div class="card mb-4">
          <div class="card-body">
            <h2 class="card-title h4 mb-3">
              <i class="bi bi-box-seam text-info me-2"></i>Top 10 Clientes que M치s Pedidos Han Realizado
            </h2>
            
            <div class="row g-3 mb-3">
              <div class="col-md-4">
                <label class="form-label fw-semibold">Fecha Inicio</label>
                <input 
                  type="datetime-local" 
                  [(ngModel)]="filtroPedidos.fechaInicio"
                  class="form-control">
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">Fecha Fin</label>
                <input 
                  type="datetime-local" 
                  [(ngModel)]="filtroPedidos.fechaFin"
                  class="form-control">
              </div>
            </div>

            <div class="d-flex gap-2 flex-wrap mb-3">
              <button (click)="aplicarRangoRapido('semana', filtroPedidos)" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-calendar-week me-1"></i>칔ltima semana
              </button>
              <button (click)="aplicarRangoRapido('mes', filtroPedidos)" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-calendar-month me-1"></i>칔ltimo mes
              </button>
              <button (click)="aplicarRangoRapido('anio', filtroPedidos)" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-calendar-range me-1"></i>칔ltimo a침o
              </button>
            </div>

            <button (click)="cargarReportePedidos()" class="btn btn-primary" [disabled]="cargandoPedidos()">
              @if (cargandoPedidos()) {
                <span class="spinner-border spinner-border-sm me-2"></span>
                Cargando...
              } @else {
                <i class="bi bi-search me-2"></i>
                Consultar
              }
            </button>
          </div>
        </div>

        @if (cargandoPedidos()) {
          <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
          </div>
        }

        @if (!cargandoPedidos()) {
          <div class="card">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th scope="col" class="text-center">#</th>
                      <th scope="col">ID Usuario</th>
                      <th scope="col">Nombre</th>
                      <th scope="col">Apellido</th>
                      <th scope="col">Email</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (cliente of clientesPedidos(); track cliente; let i = $index) {
                      <tr>
                        <td class="text-center fw-bold">{{ i + 1 }}</td>
                        <td>{{ cliente.id_usuario }}</td>
                        <td>{{ cliente.nombre }}</td>
                        <td>{{ cliente.apellido }}</td>
                        <td>{{ cliente.email }}</td>
                      </tr>
                    }
                  </tbody>
                </table>
                @if (clientesPedidos().length === 0) {
                  <div class="alert alert-info text-center">
                    <i class="bi bi-info-circle me-2"></i>No hay datos disponibles para el per칤odo seleccionado
                  </div>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }

    <!-- Tab: Top 10 Clientes con M치s Productos en Venta -->
    @if (pestanaActiva() === 'productos-venta') {
      <div class="tab-pane fade show active">
        <div class="card mb-4">
          <div class="card-body">
            <h2 class="card-title h4 mb-3">
              <i class="bi bi-shop text-warning me-2"></i>Top 10 Clientes con M치s Productos a la Venta
            </h2>
            <p class="text-muted">
              <i class="bi bi-info-circle-fill me-1"></i>
              Este reporte muestra el estado actual del inventario (no requiere fechas)
            </p>
            <button (click)="cargarReporteProductosVenta()" class="btn btn-primary" [disabled]="cargandoProductosVenta()">
              @if (cargandoProductosVenta()) {
                <span class="spinner-border spinner-border-sm me-2"></span>
                Cargando...
              } @else {
                <i class="bi bi-arrow-clockwise me-2"></i>
                Actualizar
              }
            </button>
          </div>
        </div>

        @if (cargandoProductosVenta()) {
          <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
          </div>
        }

        @if (!cargandoProductosVenta()) {
          <div class="card">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th scope="col" class="text-center">#</th>
                      <th scope="col">ID Usuario</th>
                      <th scope="col">Nombre</th>
                      <th scope="col">Apellido</th>
                      <th scope="col">Email</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (cliente of clientesProductosVenta(); track cliente; let i = $index) {
                      <tr>
                        <td class="text-center fw-bold">{{ i + 1 }}</td>
                        <td>{{ cliente.id_usuario }}</td>
                        <td>{{ cliente.nombre }}</td>
                        <td>{{ cliente.apellido }}</td>
                        <td>{{ cliente.email }}</td>
                      </tr>
                    }
                  </tbody>
                </table>
                @if (clientesProductosVenta().length === 0) {
                  <div class="alert alert-info text-center">
                    <i class="bi bi-info-circle me-2"></i>No hay datos disponibles
                  </div>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>